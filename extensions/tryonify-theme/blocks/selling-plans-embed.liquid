{% liquid
  assign cart_trial_items = 0

  for item in cart.items 
    if item.selling_plan_allocation
      assign cart_trial_items = cart_trial_items | plus: item.quantity
    endif
  endfor
%}
<div class="tryonify-embed" data-embed-target="{{ block.settings.embed_target }}">
  <div class="tryonify-selling-plan-wrapper">
    {% if block.settings.style == 'expanded' %}
      {% render 'expanded', variable: cart_trial_items %}
    {% endif %}
  
    {% if block.settings.style == 'compact' %}
      {% render 'compact', cart_trial_items: cart_trial_items, button_text: block.settings.button_text, button_class: block.settings.button_class %}
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Trial Offers",
  "templates": ["product"],
  "target": "body",
  "stylesheet": "styles.css",
  "javascript": "add-plan.js",
  "settings": [
    {
      "type": "text",
      "id": "embed_target",
      "label": "Embed target",
      "info": "Insert trial options into HTML element with this selector."
    },
    {
      "type": "radio",
      "id": "style",
      "label": "Style",
      "options": [
        {
          "value": "expanded",
          "label": "Expanded"
        },
        {
          "value": "compact",
          "label": "Compact"
        }
      ]
    },
    {
      "type": "header",
      "content": "Compact Styling"
    },
    {
      "type": "paragraph",
      "content": "These settings are used when the app block style is set to Compact."
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Try For Free"
    },
    {
      "type": "text",
      "id": "button_class",
      "label": "Button Class",
      "default": "tryonify-button"
    }
  ]
}
{% endschema %}